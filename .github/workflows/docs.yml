name: Deploy Documentation

on:
    push:
        branches: [main, development]
        paths: ["docs/**"]
    pull_request:
        branches: [main]
        paths: ["docs/**"]

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Setup Ruby
              uses: ruby/setup-ruby@v1
              with:
                  ruby-version: "3.1"
                  bundler-cache: true

            - name: Setup Jekyll
              run: |
                  cd docs
                  bundle config set --local path 'vendor/bundle'
                  bundle install

            - name: Build Jekyll site
              run: |
                  cd docs
                  bundle exec jekyll build --destination ../_site

            - name: Deploy to GitHub Pages
              if: github.ref == 'refs/heads/main'
              uses: peaceiris/actions-gh-pages@v3
              with:
                  github_token: ${{ secrets.GITHUB_TOKEN }}
                  publish_dir: ./_site
                  cname: osmynt.dev
